<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author" content="James Shubin">

	<title>Kubernetes clusters with Oh-My-Vagrant - https://purpleidea.com/</title>
	<link rel="canonical" href="https://purpleidea.com/blog/2015/05/02/kubernetes-clusters-with-oh-my-vagrant/">

	<link href="/css/bootstrap.min.css" rel="stylesheet">
	<link href="/css/fontawesome-all.css" rel="stylesheet">
	<link href="/css/custom.css" rel="stylesheet">
	<link href="/css/staticman.css" rel="stylesheet">


	


</head>
<body>
	<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
					<span class="sr-only">Toggle Navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="https://purpleidea.com/">purpleidea.com</a>
			</div>
			<div class="collapse navbar-collapse navbar-ex1-collapse">
				<ul class="nav navbar-nav">

					<li><a href="/about/">about</a></li>
					<li><a href="/blog/">blog</a></li>
					<li><a href="/projects/">projects</a></li>
					<li><a href="/talks/">talks</a></li>
					<li><a href="/misc/">misc</a></li>
					<li><a href="/contact/">contact</a></li>
				</ul>
			</div>
		</div>
	</nav>

	<div class="container">

	<div class="row">
		<div class="col-md-9">
			<div class="well well-sm">
					<h3><strong>Kubernetes clusters with Oh-My-Vagrant</strong><br><small></small></h3>
					<hr>
					<p>I&rsquo;ve added the ability to deploy a <a href="https://github.com/GoogleCloudPlatform/kubernetes">Kubernetes</a> cluster with <a href="https://github.com/purpleidea/oh-my-vagrant">Oh-My-Vagrant</a> (<em>omv</em>). I&rsquo;ve also built an automated developer experience so that you can test your Kubernetes powered app in minutes. If you want to redeploy a new version, or see how your app behaves during a <a href="https://github.com/GoogleCloudPlatform/kubernetes/blob/master/docs/kubectl_rolling-update.md">rolling update</a>, you can use <em>omv</em> to test this out in minutes! I&rsquo;ve recorded a <a href="https://dl.fedoraproject.org/pub/alt/purpleidea/screencasts/oh-my-vagrant-kubernetes-screencast.ogv">screencast</a> (~15 min), if you&rsquo;d like to see some of this in action.</p>
<p><span style="text-decoration:underline;">Background</span>:</p>
<p>Kubernetes is a container cluster manager. It groups containers into <a href="https://github.com/GoogleCloudPlatform/kubernetes/blob/master/docs/pods.md">pods</a>, and those pods get scheduled to run on a certain machine in the cluster. We&rsquo;ll be talking about <a href="https://en.wikipedia.org/wiki/Docker_%28software%29">Docker containers</a> in this article, although there are lots of great new technologies such as <a href="http://0pointer.net/blog/systemd-for-administrators-part-xxi.html">nspawn</a>.</p>
<p>An <em>advantage</em> of using Kubernetes is that it was created by a team at Google, who has a lot of experience running containers. A lot of smart folks (including many from <a href="https://redhat.com/">Red Hat</a>) are working on this project too! It is becoming the foundation for other software such as <a href="https://blog.openshift.com/openshift-v3-deep-dive-docker-kubernetes/">OpenShift v3</a>. Google has released a <a href="https://static.googleusercontent.com/media/research.google.com/en//pubs/archive/43438.pdf">paper</a> on their earlier work (Borg), which is interesting, but lacks many details, and (unsurprisingly) no source code is present.</p>
<p>Some big <em>disadvantages</em> include the requirement of a <a href="https://sfconservancy.org/blog/2014/jun/09/do-not-need-cla/">CLA</a> to contribute to the project, and the lack of good documentation and articles about it. Kubernetes itself, can&rsquo;t yet be decentralized, but this might change in the future. It&rsquo;s (currently) very difficult to construct the <em>foo.json</em> files required to build an application.</p>
<p>While the project is open source (ALv2) I&rsquo;ve gotten the feeling that Google has a pretty strong hold on the project and has some changes to make before the community really trusts them. This can be a learning experience for any company where proprietary software is the culture. I wish them well on their <a href="https://www.gnu.org/philosophy/free-sw.html">journey</a>!</p>
<p><span style="text-decoration:underline;">Oh-My-Vagrant integration</span>:</p>
<p>To deploy a Kubernetes cluster with <em>omv</em>, the <code>kubernetes</code> variable needs to be set to something meaningful. It&rsquo;s also recommended that you boot up a minimum of <em>three</em> machines. Here is an except from an <a href="https://github.com/purpleidea/oh-my-vagrant/blob/master/examples/docker-kubernetes.yaml">example</a> <code>omv.yaml</code> config:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>:domain: example.com
</span></span><span style="display:flex;"><span>:network: 192.168.123.0/24
</span></span><span style="display:flex;"><span>:image: centos-7.1-docker
</span></span><span style="display:flex;"><span>:sync: rsync
</span></span><span style="display:flex;"><span>:extern:
</span></span><span style="display:flex;"><span>- type: git
</span></span><span style="display:flex;"><span>  system: docker
</span></span><span style="display:flex;"><span>  repository: https://github.com/purpleidea/docker-simple1
</span></span><span style="display:flex;"><span>  directory: docker-simple1
</span></span><span style="display:flex;"><span>- type: git
</span></span><span style="display:flex;"><span>  system: kubernetes
</span></span><span style="display:flex;"><span>  repository: https://github.com/purpleidea/kube-simple1
</span></span><span style="display:flex;"><span>  directory: kube-simple1
</span></span><span style="display:flex;"><span>:puppet: false
</span></span><span style="display:flex;"><span>:docker: []
</span></span><span style="display:flex;"><span>:kubernetes:
</span></span><span style="display:flex;"><span>  applications:
</span></span><span style="display:flex;"><span>  - kube-simple1/simple1.json
</span></span><span style="display:flex;"><span>:vms: []
</span></span><span style="display:flex;"><span>:namespace: omv
</span></span><span style="display:flex;"><span>:count: 3
</span></span></code></pre></div><p>In the above example, you can see that we&rsquo;ve only listed one Kubernetes application, but an arbitrary number can be included. The <code>kubernetes</code> variable can also accept a key named <code>master</code> if you&rsquo;d like to choose which of your vm&rsquo;s should be the primary. If you don&rsquo;t specify this, the first vagrant machine will be chosen.</p>
<p>In the list of applications, instead of only specifying the .json file, you can instead specify a dictionary of key/value pairs. The .json key (<code>file</code>) is required, but you can also specify additional keys, such as the <em>boolean</em> key <code>roll</code>. When <em>true</em>, it will cause a rolling update to occur instead of a normal&quot; update.</p>
<p>If you&rsquo;re interested to see what needs to be done to set up Kubernetes, the bulk of the work was done by me in <a href="https://github.com/purpleidea/oh-my-vagrant/commit/1f26e5bda5d7585f7b26babcb56a529cc34b96bd">1f26</a>, but figuring out manual steps was only possible thanks to the work of my hacker friends: <a href="https://twitter.com/collier_s">scollier</a> and <a href="https://github.com/eparis/">eparis</a>.</p>
<p>Due to the power of the <em>omv</em> project, when you <code>vagrant up</code>, the necessary docker and Kubernetes projects listed in the <code>extern</code> variable will be automatically cloned and pulled into your <em>omv</em> environment.</p>
<p><span style="text-decoration:underline;">Screencast</span>:</p>
<p>You&rsquo;re probably due for a screencast (~15 min). Have a watch, and then if you need review, go back and read what I&rsquo;ve written above.</p>
<p><a href="https://dl.fedoraproject.org/pub/alt/purpleidea/screencasts/oh-my-vagrant-kubernetes-screencast.ogv"><a href="https://dl.fedoraproject.org/pub/alt/purpleidea/screencasts/oh-my-vagrant-kubernetes-screencast.ogv">https://dl.fedoraproject.org/pub/alt/purpleidea/screencasts/oh-my-vagrant-kubernetes-screencast.ogv</a></a></p>
<p>(Thanks to the Gluster community for generously hosting this video!)</p>
<p><span style="text-decoration:underline;">Final thoughts</span>:</p>
<p>I haven&rsquo;t talked about networking, or actually building applications.</p>
<p>Container network might be a lot easier if you use an overlay network like <a href="https://github.com/purpleidea/oh-my-vagrant/issues/76">flannel</a>. Unfortunately, this isn&rsquo;t yet built into Oh-My-Vagrant, but is in the list of <a href="https://github.com/purpleidea/oh-my-vagrant/issues/76">feature requests</a> if someone shows some interest.</p>
<p>Building useful applications is harder. In my screencast, you&rsquo;ll see where to put the code, and how to iterate on it, but not what kind of code to write, or architecturally how your multi-container applications should work. Unfortunately this is out of scope for today&rsquo;s article! My goal was to make it easy for you to focus on that topic, instead of having to figure out how to build the infrastructure. Hopefully Oh-My-Vagrant helps you accomplish that!</p>
<p>Happy hacking,</p>
<p>James</p>
<p><br /><i>You can <a target="_blank" href="https://m9rx.com/">hire James</a> and his team at <a target="_blank" href="https://m9rx.com/">m9rx corporation</a>.</i>

<br /><i>You can <a target="_blank" href="https://mastodon.social/@purpleidea">follow James on Mastodon</a> for more frequent updates and other random thoughts.</i>

<br /><i>You can <a target="_blank" href="https://twitter.com/intent/follow?screen_name=purpleidea">follow James on Twitter</a> for more frequent updates and other random thoughts.</i>

<br /><i>You can <a target="_blank" href="https://github.com/sponsors/purpleidea/">support James on GitHub</a> if you'd like to help sustain this kind of content.</i>

<br /><i>You can <a target="_blank" href="https://www.patreon.com/purpleidea">support James on Patreon</a> if you'd like to help sustain this kind of content.</i>
</p>

			</div>
		</div>

		
		<div class="col-md-3">
			<div class="well well-sm"> 
				<h4>May 2, 2015<br>
				<small>804 words</small></h4>
				<hr>
				<strong>Categories</strong>
				<ul class="list-unstyled">
				
					<li><a href="/categories/technical">technical</a></li>
				
				</ul>
				<hr>
				<strong>Tags</strong><br>
				<a class="label label-default" href="/tags/atomic">atomic</a> <a class="label label-default" href="/tags/borg">borg</a> <a class="label label-default" href="/tags/containers">containers</a> <a class="label label-default" href="/tags/devops">devops</a> <a class="label label-default" href="/tags/docker">docker</a> <a class="label label-default" href="/tags/fedora">fedora</a> <a class="label label-default" href="/tags/gluster">gluster</a> <a class="label label-default" href="/tags/google">google</a> <a class="label label-default" href="/tags/json">json</a> <a class="label label-default" href="/tags/kubernetes">kubernetes</a> <a class="label label-default" href="/tags/oh-my-vagrant">oh-my-vagrant</a> <a class="label label-default" href="/tags/openshift">openshift</a> <a class="label label-default" href="/tags/planetdevops">planetdevops</a> <a class="label label-default" href="/tags/planetfedora">planetfedora</a> <a class="label label-default" href="/tags/planetpuppet">planetpuppet</a> <a class="label label-default" href="/tags/pods">pods</a> <a class="label label-default" href="/tags/redhat">redhat</a> <a class="label label-default" href="/tags/screencast">screencast</a> <a class="label label-default" href="/tags/systemd-nspawn">systemd-nspawn</a> 
				
				<hr>
				<strong>Original URL</strong><br>
				<a href="https://ttboj.wordpress.com/2015/05/02/kubernetes-clusters-with-oh-my-vagrant/"><small>https://ttboj.wordpress.com/2015/05/02/kubernetes-clusters-with-oh-my-vagrant/</small></a>
				

				
			</div>
				<div class="panel panel-default">
		<div class="panel-heading" style="padding: 2px 15px;">
			<h4>Links...</h4>
		</div>
		<div class="panel-body">

			<a href="https://twitter.com/purpleidea" class="btn btn-info btn-xs"><i class="fa-brands fa-twitter-square fa-2x"></i></a>


			<a href="https://github.com/purpleidea/" class="btn btn-primary btn-xs"><i class="fa-brands fa-github-square fa-2x"></i></a>


			<a href="https://mastodon.social/@purpleidea" class="btn btn-primary btn-xs" style="background:#563ACC"><i class="fa-brands fa-mastodon fa-2x"></i></a>


	

			
		</div>
	</div>

		</div>
	</div>

	<div class="row">
		<hr>

	
<a name="comments"></a>
<section class="post-comments">
	<h3>Comments</h3>






	

	


	<p>Nothing yet.</p>

	<hr />
	<a name="comment"></a>
	<h3>Post a comment</h3>
	<form class="post-new-comment" method="POST" action="https://api.staticman.net/v2/entry/purpleidea/purpleidea.com/master/comments">
		<input type="hidden" name="options[redirect]" value="https://purpleidea.com/blog/2015/05/02/kubernetes-clusters-with-oh-my-vagrant/#comment-submitted">
		<input type="hidden" name="options[entryId]" value="blog/2015/05/02/kubernetes-clusters-with-oh-my-vagrant">
		<input type="hidden" name="options[reCaptcha][siteKey]" value="6Lc0u2EUAAAAAImKX7XafINIzeoLZFQCGFKF7qCp">
		<input type="hidden" name="options[reCaptcha][secret]" value="AEl4ul2uMOx2EL2LMm/84zzh8mWLYIYW&#43;v2EEu7webGOtAqyQiLBa6QLjPgnlyNjJxE3UeccxuBQIWqPzG96FsVl0AVTihhHt3OGR1hteAZUAhoJjnH&#43;7PoyC3x7d4KDLypopDn&#43;HzWowOpAZuvfHE08n&#43;G4omrP5fUfkOrH03A=">
		<div class="col-md-9">
			<div class="row">
				<textarea name="fields[message]" style="width: 80%; height: 50px;" class="post-comment-field" placeholder="Please enter your comment here..." rows="10"></textarea><br />
			</div>
			<div class="row">
				<input name="fields[name]" type="text" style="width: 50%;" class="post-comment-field" placeholder="Your name">
			</div>
			<div class="row">
				<input name="fields[email]" type="email" style="width: 50%;" class="post-comment-field" placeholder="Your email address">
			</div>
			<div class="row">
				<input name="fields[url]" type="text" style="width: 50%;" class="post-comment-field" placeholder="Your website">
			</div>
			<div class="row">
				<br />
				<div class="g-recaptcha" data-sitekey="6Lc0u2EUAAAAAImKX7XafINIzeoLZFQCGFKF7qCp"></div>
				<script src='https://www.google.com/recaptcha/api.js'></script>
				(sorry but the spammers were getting too crazy!)
			</div>
			<div class="row">
				<input type="submit" style="width: 80%;" class="post-comment-field btn btn-primary btn-xs" value="Submit">
			</div>
		</div>
	</form>
</section>

<div id="comment-submitted" class="dialog">
	<hr />
	<h3>Thank you</h3>
	<p>Your comment has been submitted and will be published if it gets approved.</p>
	<p><a href="https://github.com/purpleidea/purpleidea.com/pulls">Click here</a> to see the patch you generated.</p>
	<p><a href="#" class="btn">OK</a></p>
</div>


	</div>
		<footer>
		<div class="row">
			<hr>
			<div class="col-sm-12">
				<p>
				&copy; James Shubin 2025 &middot;
				<a href="https://purpleidea.com/">https://purpleidea.com/</a>
				
					&middot;
					<a href="https://github.com/purpleidea/purpleidea.com/blob/master/content/blog/2015/05/02/kubernetes-clusters-with-oh-my-vagrant.md" style="color:grey">Edit this page</a>
				
				</p>
			</div>
		</div>
		</footer>
	</div>

	<script src="/js/jquery-1.11.3.min.js"></script>
	<script src="/js/bootstrap.js"></script>
</body>
</html>

